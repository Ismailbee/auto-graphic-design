<template>  <div class="panel">    <div class="search-bar">      <i class="fas fa-search"></i>      <input type="text" placeholder="Search templates..." v-model="searchQuery">    </div>    <div class="category-filters">      <button         v-for="category in categories"         :key="category"         @click="activeCategory = category"        :class="{ active: activeCategory === category }"      >        {{ category }}      </button>    </div>    <div class="template-grid">      <div         v-for="template in filteredTemplates"         :key="template.id"         class="template-item"         @click="applyTemplate(template)"      >        <img :src="template.thumbnail" :alt="template.name" class="template-thumbnail" />        <div class="template-overlay">          <span class="template-name">{{ template.name }}</span>        </div>      </div>    </div>  </div></template><script setup>import { ref, computed } from 'vue';import { useCanvasStore } from '../../../../stores/canvas-konva';import { useNotification } from '../../../../composables/useNotification';// Mock data for templatesimport flyerThumb from '@/assets/template/flyer.jpg';import invitationThumb from '@/assets/template/invitation.jpg';import memoThumb from '@/assets/template/Memo.png';import namingThumb from '@/assets/template/naming Ceremony Memo.jpg';import stickerThumb from '@/assets/template/stiker design.jpg';const canvasStore = useCanvasStore();const { showSuccess, showError } = useNotification();const searchQuery = ref('');const activeCategory = ref('All');const categories = ['All', 'Business', 'Social', 'Events', 'Personal'];const templates = ref([  { id: 1, name: 'Corporate Flyer', category: 'Business', thumbnail: flyerThumb },  { id: 2, name: 'Wedding Invitation', category: 'Events', thumbnail: invitationThumb },  { id: 3, name: 'Team Memo', category: 'Business', thumbnail: memoThumb },  { id: 4, name: 'Naming Ceremony', category: 'Events', thumbnail: namingThumb },  { id: 5, name: 'Product Sticker', category: 'Business', thumbnail: stickerThumb },  { id: 6, name: 'Instagram Post', category: 'Social', thumbnail: 'https://via.placeholder.com/150/8e44ad/ffffff?text=Social' },  { id: 7, name: 'Birthday Card', category: 'Personal', thumbnail: 'https://via.placeholder.com/150/f1c40f/ffffff?text=Personal' },]);const filteredTemplates = computed(() => {  let items = templates.value;  if (activeCategory.value !== 'All') {    items = items.filter(t => t.category === activeCategory.value);  }  if (searchQuery.value) {    items = items.filter(t => t.name.toLowerCase().includes(searchQuery.value.toLowerCase()));  }  return items;});function applyTemplate(template) {  if (!canvasStore.stageInstance) {    showError('Canvas is not ready.');    return;  }  canvasStore.clearCanvas();  const image = new Image();  image.src = template.thumbnail;  image.onload = () => {    const canvasSize = canvasStore.canvasSize;    const padding = 50;    const maxWidth = canvasSize.width - padding * 2;    const maxHeight = canvasSize.height - padding * 2;    let scale = Math.min(maxWidth / image.width, maxHeight / image.height);    scale = Math.min(scale, 1); // Don't scale up    const imgWidth = image.width * scale;    const imgHeight = image.height * scale;    canvasStore.addImage({      src: template.thumbnail,      x: (canvasSize.width - imgWidth) / 2,      y: (canvasSize.height - imgHeight) / 2,      width: imgWidth,      height: imgHeight,      draggable: true,    });    canvasStore.saveState();    showSuccess(`Applied '${template.name}' template.`);  };}</script><style scoped>.panel {  display: flex;  flex-direction: column;  gap: 16px;  height: 100%;}.search-bar {  position: relative;}.search-bar i {  position: absolute;  left: 12px;  top: 50%;  transform: translateY(-50%);  color: #9ca3af;}.search-bar input {  width: 100%;  padding: 10px 12px 10px 36px;  border-radius: 8px;  border: 1px solid #e5e7eb;  background-color: white;}.dark-theme .search-bar input {  background-color: #1f2937;  border-color: #374151;  color: #e5e7eb;}.category-filters {  display: flex;  gap: 8px;  overflow-x: auto;  padding-bottom: 8px; /* For scrollbar */}.category-filters button {  padding: 6px 12px;  border-radius: 16px;  border: 1px solid transparent;  background-color: #f3f4f6;  color: #4b5563;  font-size: 13px;  font-weight: 500;  cursor: pointer;  transition: all 0.2s;  white-space: nowrap;}.dark-theme .category-filters button {  background-color: #374151;  color: #d1d5db;}.category-filters button.active {  background-color: #4f46e5;  color: white;  border-color: #4f46e5;}.dark-theme .category-filters button.active {  background-color: #4338ca;}.template-grid {  flex: 1;  display: grid;  grid-template-columns: repeat(2, 1fr);  gap: 12px;  overflow-y: auto;  padding-right: 4px; /* For scrollbar */}.template-item {  position: relative;  cursor: pointer;  border-radius: 8px;  overflow: hidden;  aspect-ratio: 4 / 3;  transition: transform 0.2s;}.template-item:hover {  transform: scale(1.03);}.template-item:hover .template-overlay {  opacity: 1;}.template-thumbnail {  width: 100%;  height: 100%;  object-fit: cover;}.template-overlay {  position: absolute;  inset: 0;  background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, transparent 60%);  display: flex;  align-items: flex-end;  padding: 8px;  opacity: 0;  transition: opacity 0.3s;}.template-name {  color: white;  font-size: 12px;  font-weight: 500;}</style>

const templates = ref([
  {
    id: 1,
    name: 'Corporate Flyer',
    category: 'Business',
    thumbnail: flyerThumb,
    elements: [
      {
        type: 'text',
        text: 'Company Name',
        fontSize: 28,
        x: 100,
        y: 80,
        fill: '#000',
        draggable: true,
      },
      {
        type: 'text',
        text: 'Your Slogan Here',
        fontSize: 18,
        x: 100,
        y: 130,
        fill: '#555',
        draggable: true,
      },
      {
        type: 'image',
        src: '', // empty placeholder
        x: 150,
        y: 200,
        width: 200,
        height: 150,
        draggable: true,
      }
    ]
  }
])

function applyTemplate(template) {
  if (!canvasStore.stageInstance) {
    showError('Canvas is not ready.');
    return;
  }

  canvasStore.clearCanvas();

  template.elements.forEach(el => {
    if (el.type === 'text') {
      canvasStore.addText(el);
    } else if (el.type === 'image') {
      canvasStore.addImage(el);
    }
  });

  canvasStore.saveState();
  showSuccess(`Applied '${template.name}' template.`);
}
